---
---

<section class="compare-wrapper">
  <h2>Compare Collections</h2>
  <div class="controls">
    <input id="cmp-a" class="mini-input" placeholder="First collection (e.g. lucide)" list="cmp-prefixes" />
    <input id="cmp-b" class="mini-input" placeholder="Second collection (e.g. carbon)" list="cmp-prefixes" />
    <button id="cmp-run" class="text-btn">Compare</button>
    <button id="cmp-copy-a" class="text-btn">Copy A-only</button>
    <button id="cmp-copy-b" class="text-btn">Copy B-only</button>
    <button id="cmp-copy-common" class="text-btn">Copy Common</button>
  </div>
  <datalist id="cmp-prefixes"></datalist>
  <div id="cmp-status" class="status" aria-live="polite"></div>
  <div class="cols">
    <div>
      <h3>Only in A</h3>
      <ul id="cmp-only-a" class="list"></ul>
    </div>
    <div>
      <h3>Common</h3>
      <ul id="cmp-common" class="list"></ul>
    </div>
    <div>
      <h3>Only in B</h3>
      <ul id="cmp-only-b" class="list"></ul>
    </div>
  </div>
</section>

<style>
.compare-wrapper { border: 1px solid var(--sl-color-gray-5); border-radius: 8px; padding: 1rem; margin-top: 1rem; }
.controls { display:flex; gap:0.5rem; align-items:center; margin-bottom:0.75rem; }
.mini-input { background: transparent; border: none; border-bottom: 1px solid var(--sl-color-gray-5); color: var(--sl-color-white); font-size: 0.9rem; padding: 0.25rem 0; }
.text-btn { background: none; border: none; font-size: 0.85rem; color: var(--sl-color-accent); text-decoration: underline; cursor: pointer; }
.status { font-size:0.85rem; color: var(--sl-color-gray-3); margin-bottom:0.75rem; }
.cols { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
.list { list-style: none; padding: 0; margin: 0; columns: 1; }
.list li { break-inside: avoid; margin-bottom: 0.25rem; font-size: 0.85rem; color: var(--sl-color-gray-2); }
</style>

<script>
// @ts-nocheck
  import { listIcons as apiListIcons } from '../../../src/api/client.js';
async function fetchList(prefix) {
  return apiListIcons(prefix);
}

function renderList(el, arr) {
  el.innerHTML = '';
  const frag = document.createDocumentFragment();
  arr.slice(0, 500).forEach((n) => { // cap for display
    const li = document.createElement('li');
    li.textContent = n;
    frag.appendChild(li);
  });
  el.appendChild(frag);
}

(function() {
  const aEl = document.getElementById('cmp-a');
  const bEl = document.getElementById('cmp-b');
  const runBtn = document.getElementById('cmp-run');
  const status = document.getElementById('cmp-status');
  const onlyA = document.getElementById('cmp-only-a');
  const onlyB = document.getElementById('cmp-only-b');
  const common = document.getElementById('cmp-common');
  const copyA = document.getElementById('cmp-copy-a');
  const copyB = document.getElementById('cmp-copy-b');
  const copyC = document.getElementById('cmp-copy-common');
  const dl = document.getElementById('cmp-prefixes');

  // Populate prefixes datalist
  (async () => {
    try {
      const { getCollections } = await import('../../../src/api/client.js');
      const prefixes = await getCollections();
      dl.innerHTML = '';
      const frag = document.createDocumentFragment();
      prefixes.forEach((p) => {
        const opt = document.createElement('option');
        opt.value = p;
        frag.appendChild(opt);
      });
      dl.appendChild(frag);
    } catch {}
  })();

  runBtn?.addEventListener('click', async () => {
    const a = (aEl?.value || '').trim();
    const b = (bEl?.value || '').trim();
    if (!a || !b) { status.textContent = 'Enter two collection prefixes to compare.'; return; }
    status.textContent = 'Loading...';
    try {
      const [listA, listB] = await Promise.all([fetchList(a), fetchList(b)]);
      const setA = new Set(listA);
      const setB = new Set(listB);
      const onlyAArr = listA.filter((n) => !setB.has(n));
      const onlyBArr = listB.filter((n) => !setA.has(n));
      const commonArr = listA.filter((n) => setB.has(n));
      renderList(onlyA, onlyAArr);
      renderList(onlyB, onlyBArr);
      renderList(common, commonArr);
      status.textContent = `A:${a} (${listA.length}) | B:${b} (${listB.length}) | Common: ${commonArr.length}`;
  // Copy handlers
  copyA.onclick = () => navigator.clipboard.writeText(onlyAArr.join('\n'));
  copyB.onclick = () => navigator.clipboard.writeText(onlyBArr.join('\n'));
  copyC.onclick = () => navigator.clipboard.writeText(commonArr.join('\n'));
    } catch (e) {
      status.textContent = e.message || 'Failed to compare collections';
    }
  });
})();
</script>
